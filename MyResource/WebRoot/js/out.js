var TLE=TLE||{};
TLE.exporter={"\u590d\u5236\u94fe\u63a5":function(a){console.log(a);var f='<ul style="max-height: 300px; overflow-y: scroll; overflow-x: hidden;">';$.each(a.tasklist,function(a,h){$.each(h.filelist,function(a,e){e.downurl&&(f+='<li><a href="'+TLE.url_rewrite(e.downurl,e.title)+'" target="_blank">'+e.title+"</a></li>")})});f+="</ul>";$("#TLE_text_pop").tpl("TLE_text_tpl",{title:"\u590d\u5236\u9009\u4e2d\u7684\u94fe\u63a5",content:f}).show().pop({onHide:function(){$(document.body).click()}})},Aria2:function(a){console.log(a);
var f="";$.each(a.tasklist,function(j,h){$.each(h.filelist,function(g,e){e.downurl&&(f+='aria2c -c -s10 -x10 --out "'+TLE.escape_command(e.title)+'" --header "Cookie: gdriveid='+a.gdriveid+';" "'+e.downurl+'"\n')})});TLE.text_pop("aria2 download command",f)},"Aria2\u5bfc\u51fa":function(a){console.log(a);var f="";$.each(a.tasklist,function(j,h){$.each(h.filelist,function(g,e){e.downurl&&(f+=e.downurl+"\r\n  out="+e.title+"\r\n  header=Cookie: gdriveid="+a.gdriveid+"\r\n  continue=true\r\n  max-connection-per-server=5\r\n  split=10\r\n  parameterized-uri=true\r\n\r\n")})});
TLE.file_pop("Aria2\u5bfc\u51fa\u6587\u4ef6\u4e0b\u8f7d",f,"aria2.down")}};
(function(a){function f(c){var b=c.attr("taskid"),d={};c.find("input").each(function(c,a){var k=a.getAttribute("id").replace(b,"");d[k]=a.getAttribute("value")});return d}function j(c){var b={taskname:c.taskname,f_url:c.f_url,cid:c.dcid,size:parseInt(c.ysfilesize),tasktype:c.d_tasktype,status:c.d_status},d=[];d.push({title:g(c.taskname),f_url:c.f_url,downurl:c.dl_url,cid:c.dcid,gcid:"",size:parseInt(c.ysfilesize)});b.filelist=d;return b}function h(c,b){var d={taskname:c.taskname,f_url:c.f_url,cid:c.dcid,
size:parseInt(c.ysfilesize),tasktype:c.d_tasktype,status:c.d_status},a=[];$.each(b,function(c,b){a.push({title:g(b.title),f_url:b.url,downurl:b.downurl,cid:b.cid,gcid:b.gcid,size:parseInt(b.filesize)})});d.filelist=a;return d}function g(c){return c.replace(/[\\\|\:\*\"\?\<\>]/g,"_")}function e(c){c=c.toString(16);return 1==c.length?"0"+c:c}function l(c){var b=["01"];for($.each(unescape(encodeURIComponent(c)),function(c,a){b.push(e(a.charCodeAt(0)^n[c%8]).toUpperCase())});1!=b.length%8;)b.push(e(n[(b.length-
1)%8]).toUpperCase());return b.join("")}a.down=function(c,b){var a=$(c).parents(".rw_list"),i=f(a);"0"==i.d_tasktype?(show_tip("\u8f7d\u5165\u4e2d..."),$.getJSON(INTERFACE_URL+"/fill_bt_list?tid="+i.input+"&g_net="+G_section+"&uid="+G_USERID+"&callback=?",function(c){hide_tip();var a={};a.gdriveid=getCookie("gdriveid");a.tasklist={};a.tasklist[i.input]=h(i,c.Result[i.input]);b(a)})):(a={},a.gdriveid=getCookie("gdriveid"),a.tasklist={},a.tasklist[i.input]=j(i),b(a))};a.batch_down=function(c,b){var a=
document.getElementsByName("ck"),i=[],e=[];$.each(a,function(c,a){if(!1!=a.checked){var b=a.value,d=$("#d_status"+b).val(),f=$("#d_tasktype"+b).val();4!=$("#dflag"+b).val()&&2==d&&(0==f?i.push(b):e.push(b))}});if(i.length)show_tip("\u8f7d\u5165\u4e2d..."),$.getJSON(INTERFACE_URL+"/fill_bt_list?tid="+i.join(",")+"&g_net="+G_section+"&uid="+G_USERID+"&callback=?",function(c){hide_tip();var a={};a.gdriveid=getCookie("gdriveid");a.tasklist={};$.each(c.Result,function(c,b){var d=f($("#tr_c"+c));a.tasklist[c]=
h(d,b)});$.each(e,function(c,b){var d=f($("#tr_c"+b));a.tasklist[b]=j(d)});b(a)});else{var g={};g.gdriveid=getCookie("gdriveid");g.tasklist={};$.each(e,function(c,b){var a=f($("#tr_c"+b));g.tasklist[b]=j(a)});b(g)}};a.bt_down=function(c,b){var a=document.getElementsByName("bt_list_ck"),e=[];$.each(a,function(c,a){if(!1!=a.checked){var b=a.getAttribute("_i"),b={title:g($("#bt_taskname"+b).val()),url:$("#bturl"+b).val(),downurl:$("#btdownurl"+b).val(),cid:$("#btcid"+b).val(),gcid:$("#btgcid"+b).val(),
filesize:$("#bt_filesize"+b).val()};e.push(b)}});var a=$("#view_bt_taskid").val(),j=f($("#tr_c"+a)),k={};k.gdriveid=getCookie("gdriveid");k.tasklist={};k.tasklist[a]=h(j,e);console.log(k);b(k);console.log("bt_down")};a.getbtn=function(c){$(c).parents(".TLE_get_btnbox").find(".TLE_p_getbtn").toggle();close_rightmenu_layer();return!1};a.text_pop=function(c,b){b=$("<div></div>").text(b).html();b='<textarea style="width: 100%; height: 260px;">'+b+"</textarea>";$("#TLE_text_pop").tpl("TLE_text_tpl",{title:c,
content:b}).show().pop({onHide:function(){$(document.body).click()}})};a.file_pop=function(c,b,a){b='<div style="width: 100%; height: 100px;"><div style="padding: 30px 0 0 30%;"><a href="data:text/html;charset=utf-8,'+encodeURIComponent(b)+'" target="_blank" title="\u53f3\u952e\u53e6\u5b58\u4e3a" class="TLE_down_btn" download="'+a+'"><span><em class="TLE_icdwlocal">\u5bfc\u51fa\u6587\u4ef6</em></span></a>'+(isChrome?"":"(\u53f3\u952e\u53e6\u5b58\u4e3a"+a+")")+"</div></div>";$("#TLE_text_pop").tpl("TLE_text_tpl",
{title:c,content:b}).show().pop({onHide:function(){$(document.body).click()}})};a.window_pop=function(c,b){$("#TLE_text_pop").tpl("TLE_text_tpl",{title:c,content:b}).show().pop({onHide:function(){$(document.body).click()}})};a.multiple_server_fix=function(c){return"'"+c.replace("gdl","'{gdl,dl.{f,g,h,i,twin}}'")+"'"};var n=[97,49,228,95,0,0,0,0];a.url_rewrite=function(c,b){return c=c.replace(/&n=\w+/,"&n="+l(b))};a.escape_command=function(c){for(var b="",a=0;a<c.length;a++)b=-1=="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".indexOf(c[a])?
b+("\\"+c[a]):b+c[a];return c};var m=function(c){var b=a.getConfig("TLE_exporter").split("|"),d="";$.each(a.exporter,function(a){-1!=b.indexOf(a)&&(d+='<a href="#" title="'+a+'" onmouseover="this.className=\'sel_on\'" onmouseout="this.className=\'\'" onclick="'+c+"(this, TLE.exporter['"+a+"'])\">"+a+"</a>")});return d};$("head").append("<style>.TLE_get_btnbox {position:relative; float:left; z-index:11}.TLE_getbtn {position: absolute; top:24px; left:0; border:1px #6FB2F3 solid; background:#fff; width:115px;-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px;-moz-box-shadow:2px 2px 3px #ddd;-webkit-box-shadow:2px 2px 3px #ddd;}.TLE_getbtn a {display:block; height:22px; line-height:22px; padding-left:18px}.TLE_getbtn a:hover {background:#E4EFF9 url(http://cloud.vip.xunlei.com/190/img/ic_dianbo.png) no-repeat 8px 8px; *background-position:8px 6px ; text-decoration:none}.TLE_get_btnbox .TLE_getlink {width:98px; height:22px; float:left; line-height:21px;*line-height:24px;display:block;color:#000000; margin-right:5px; overflow:hidden;background:url(http://cloud.vip.xunlei.com/190/img/bg_btnall.png?197) no-repeat  0 -390px}.TLE_get_btnbox .TLE_link_gettxt {float:left; display: inline ; width:53px; text-align:center; padding-left:24px; color:#000}.TLE_get_btnbox .TLE_link_gettxt:hover {text-decoration:none}.rwbox .rwset .TLE_link_getic {float:left; display:block; width:20px;height:22px;}.TLE_hiden {display: none; }.TLE_down_btn {background: url(http://cloud.vip.xunlei.com/190/img/lx/bg_rpx.png) no-repeat 0 999em; display: block; float: left; margin: 0 1px; overflow: hidden; color: white; height: 28px; padding-left: 8px; background-position: 0 -60px; text-decoration: none; }.TLE_down_btn span {background: url(http://cloud.vip.xunlei.com/190/img/lx/bg_rpx.png) no-repeat 0 999em; display: block; float: left; height: 28px; line-height: 27px; cursor: pointer; padding-right: 8px; background-position:100% -60px; }.TLE_down_btn:active {background-position:0 -28px; }.TLE_down_btn:active span {background-position:right -28px;}.TLE_icdwlocal { padding-left: 20px; display: inline-block; background: url(http://cloud.vip.xunlei.com/190/img/lx/bg_menu.png) no-repeat 0 999em; background-position: 0 -108px; }.rwbtn.ic_redownloca { display: none !important; }.menu { width: 630px !important; }</style>");
$("body").append('<div id="TLE_text_pop" class="pop_rwbox" style="display: none;margin: 0;"></div>');$("body").append('<textarea id="TLE_text_tpl" style="display: none;"></textarea>');$("#TLE_text_tpl").text('<div class="p_rw_pop"><div class="tt_box onlytitle"><h3>$[title]</h3></div><div class="psc_info">$[content]</div><a href="#" class="close" title="\u5173\u95ed">\u5173\u95ed</a></div>');a.getConfig=function(a){return window.localStorage?window.localStorage.getItem(a)||"":getCookie(a)};a.setConfig=
function(a,b){window.localStorage?window.localStorage.setItem(a,b):setGdCookie(a,b,31536E3)};if(""==a.getConfig("TLE_exporter")){var o=[],p;for(p in a.exporter)o.push(p);a.setConfig("TLE_exporter",o.join("|"))}$("#setting_main_tpl").text($("#setting_main_tpl").text().replace(/(<\/div>\s+<div class="btnin">)/,'<div class="doline mag01"></div><h3 style="background-position: 0 -180px;">Thunder Lixian Exporter \u8bbe\u5b9a</h3><ul><li><b>\u542f\u7528\u4ee5\u4e0b\u5bfc\u51fa\u5668</b></li><li>'+function(){var c=
a.getConfig("TLE_exporter").split("|"),b="",d;for(d in a.exporter)b+='<span class="rw_col"><input type="checkbox" class="TLE_setting_ck" name="TLE_ck_'+d+'" '+(-1==c.indexOf(d)?"":"checked")+" />"+d+"</span>";return b}()+'</li><li><b>Aria2 JSON-RPC Path</b></li><li>Path: <input type="text" id="TLE_aria2_jsonrpc" style="width: 350px" value="'+a.getConfig("TLE_aria2_jsonrpc")+'"/></li></ul>$1'));var q=set_notice_submit;set_notice_submit=function(c){q(c);var b=[];$(".TLE_setting_ck").each(function(a,
c){c.checked&&b.push(c.name.replace(/^TLE_ck_/,""))});var c=0==b.length?"_":b.join("|"),d=$("#TLE_aria2_jsonrpc").val();if(a.getConfig("TLE_exporter")!=c||a.getConfig("TLE_aria2_jsonrpc")!=d)a.setConfig("TLE_exporter",c),a.setConfig("TLE_aria2_jsonrpc",d),TS2.show("\u8bbe\u7f6e\u5df2\u751f\u6548",1),setTimeout(function(){setting.hide();location.reload(!0)},1E3)};$(".rwbtn.ic_redownloca").each(function(a,b){$(b).after('<div class="TLE_get_btnbox"><span class="TLE_getlink"><a href="#" class="TLE_link_gettxt TLE-down-text" style="padding-left: 20px; width: 57px;" onclick='+
b.getAttribute("onclick")+'>\u53d6\u56de\u672c\u5730</a><a href="#" class="TLE_link_getic TLE-down-btn" onclick="return TLE.getbtn(this);"></a></span><div class="TLE_p_getbtn TLE_getbtn" style="display: none;">'+m("TLE.down")+"</div></div>")});$("#li_task_down").after('<a href="#" id="TLE_batch_down" title="\u6279\u91cf\u5bfc\u51fa" class="btn_m noit"><span><em class="icdwlocal">\u6279\u91cf\u5bfc\u51fa</em></span></a>').parents(".main_link").append('<div id="TLE_batch_getbtn" class="TLE_getbtn" style="top: 30px; display:none;">'+
m("TLE.batch_down")+"</div>");var r=task_check_click;task_check_click=function(){r();$("#li_task_down").hasClass("noit")?$("#TLE_batch_down").addClass("noit").unbind("click"):$("#TLE_batch_down").removeClass("noit").unbind("click").click(function(){$("#TLE_batch_getbtn").css("left",$("#TLE_batch_down").position().left);$("#TLE_batch_getbtn").toggle();return!1});console.log("task_check_click called")};$("input[name=ck]").click(task_check_click);$("#view_bt_list_nav_tpl").text($("#view_bt_list_nav_tpl").text().replace('<a href="#" class="btn_m noit" title="\u4e91\u8f6c\u7801"',
'<a href="#" class="btn_m noit" title="\u6279\u91cf\u5bfc\u51fa" id="TLE_bt_down"><span><em class="icdwlocal">\u6279\u91cf\u5bfc\u51fa</em></span></a><div id="TLE_bt_getbtn" class="TLE_getbtn" style="top: 30px; display:none;">'+m("TLE.bt_down")+'</div><a href="#" class="btn_m noit" title="\u4e91\u8f6c\u7801"'));var s=bt_view_nav;bt_view_nav=function(){s();$("#view_bt_list_nav_down").hasClass("noit")?$("#TLE_bt_down").addClass("noit").unbind("click"):$("#TLE_bt_down").removeClass("noit").unbind("click").click(function(){$("#TLE_bt_getbtn").css("left",
$("#TLE_bt_down").position().left);$("#TLE_bt_getbtn").toggle();return!1});$("#TLE_bt_getbtn").hide();console.log("bt_view_nav called")};$(document.body).bind("click",function(){$("div.TLE_p_getbtn, #TLE_batch_getbtn, #TLE_bt_getbtn").hide()});$("div.rw_list").click(function(){$("div.TLE_p_getbtn, #TLE_batch_getbtn, #TLE_bt_getbtn").hide()});$("div.TLE_get_btnbox").click(function(a){a.stopPropagation()})})(TLE);
var ARIA2=function(){return function(a){this.jsonrpc_path=a;this.addUri=function(a,j){var h=this.jsonrpc_path,g=[[a],j],e={jsonrpc:"2.0",method:"aria2.addUri",id:(new Date).getTime().toString()};g&&(e.params=g);var g=new XMLHttpRequest,l=h.match(/^(?:(?![^:@]+:[^:@\/]*@)[^:\/?#.]+:)?(?:\/\/)?(?:([^:@]*(?::[^:@]*)?)?@)?/)[1];g.open("POST",h+"?tm="+(new Date).getTime().toString(),!0);g.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");l&&g.setRequestHeader("Authorization",
"Basic "+btoa(l));g.send(JSON.stringify(e))};return this}}();
